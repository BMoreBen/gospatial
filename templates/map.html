<!DOCTYPE html>
<html>
    <head>
        
        <meta charset=utf-8 />
        <title>Go Geospatial</title>

        <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />

        <!--  Leaflet.draw  -->
        <script src="/Leaflet.draw/libs/leaflet-src.js"></script>
        <link rel="stylesheet" href="/Leaflet.draw/libs/leaflet.css" />
        <script src="/Leaflet.draw-with-touch/src/Leaflet.draw.js"></script>
        <link rel="stylesheet" href="/Leaflet.draw/dist/leaflet.draw.css" />
        <script src="/Leaflet.draw-with-touch/src/Toolbar.js"></script>
        <script src="/Leaflet.draw-with-touch/src/Tooltip.js"></script>
        <script src="/Leaflet.draw-with-touch/src/ext/TouchEvents.js"></script>
        <script src="/Leaflet.draw-with-touch/src/ext/GeometryUtil.js"></script>
        <script src="/Leaflet.draw-with-touch/src/ext/LatLngUtil.js"></script>
        <script src="/Leaflet.draw-with-touch/src/ext/LineUtil.Intersect.js"></script>
        <script src="/Leaflet.draw-with-touch/src/ext/Polygon.Intersect.js"></script>
        <script src="/Leaflet.draw-with-touch/src/ext/Polyline.Intersect.js"></script>
        <script src="/Leaflet.draw-with-touch/src/draw/DrawToolbar.js"></script>
        <script src="/Leaflet.draw-with-touch/src/draw/handler/Draw.Feature.js"></script>
        <script src="/Leaflet.draw-with-touch/src/draw/handler/Draw.SimpleShape.js"></script>
        <script src="/Leaflet.draw-with-touch/src/draw/handler/Draw.Polyline.js"></script>
        <script src="/Leaflet.draw-with-touch/src/draw/handler/Draw.Circle.js"></script>
        <script src="/Leaflet.draw-with-touch/src/draw/handler/Draw.Marker.js"></script>
        <script src="/Leaflet.draw-with-touch/src/draw/handler/Draw.Polygon.js"></script>
        <script src="/Leaflet.draw-with-touch/src/draw/handler/Draw.Rectangle.js"></script>
        <script src="/Leaflet.draw-with-touch/src/edit/EditToolbar.js"></script>
        <script src="/Leaflet.draw-with-touch/src/edit/handler/EditToolbar.Edit.js"></script>
        <script src="/Leaflet.draw-with-touch/src/edit/handler/EditToolbar.Delete.js"></script>
        <script src="/Leaflet.draw-with-touch/src/Control.Draw.js"></script>
        <script src="/Leaflet.draw-with-touch/src/edit/handler/Edit.Poly.js"></script>
        <script src="/Leaflet.draw-with-touch/src/edit/handler/Edit.SimpleShape.js"></script>
        <script src="/Leaflet.draw-with-touch/src/edit/handler/Edit.Circle.js"></script>
        <script src="/Leaflet.draw-with-touch/src/edit/handler/Edit.Rectangle.js"></script>
        <script src="/Leaflet.draw-with-touch/src/edit/handler/Edit.Marker.js"></script>

        <!--  Leaflet.measure  -->
        <script src="/leaflet.measure/leaflet.measure.js"></script>
        <link rel="stylesheet" href="/leaflet.measure/leaflet.measure.css" />

        <!-- Leaflet.geosearch -->
        <script src="/L.GeoSearch/src/js/l.control.geosearch.js"></script>
        <script src="/L.GeoSearch/src/js/l.geosearch.provider.openstreetmap.js"></script>
        <link rel="stylesheet" href="/L.GeoSearch/src/css/l.geosearch.css" />

        <!-- Leaflet.buildings -->
        <script src="/osmbuildings/dist/OSMBuildings-Leaflet.js"></script>

        <!-- JQuery -->
        <script src="/jquery/jquery-1.11.0.js"></script> 

        <!-- D3 -->
        <script src="/d3/d3.min.js"></script>

        <!-- LOCATE CONTROL -->
        <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
        <link rel="stylesheet" href="/leaflet.locate/L.Control.Locate.min.css" />
        <script src="/leaflet.locate/L.Control.Locate.min.js" ></script>

        <!-- HEAT MAP -->
    <!--
        <script src='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-heat/v0.1.0/leaflet-heat.js'></script>
    -->
        <!-- <script src='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-heat/v0.1.3/leaflet-heat.js'></script> -->

        <!-- Font Awesome CSS -->
        <link rel="stylesheet" href="/font-awesome-4.6.3/css/font-awesome.min.css">

        <!-- MapClient -->
        <script src="/gospatialjs/gospatial-api.js?{{.Version}}"></script>
        <script src='/find/L.GoSpatial.js?{{.Version}}'></script> 
        <link href="/find/find-style.css?{{.Version}}" rel="stylesheet">

    </head>
    <body>

        <div id='error'>
            <div class='err'>
                <span></span>
            </div>
            <div class='err'>
                <img class='error' src='/images/error.png'>
            </div>
        </div>

        <div id='map'> </div>

        <script>

            $(function(){
                $("#error").hide();
                initialize("map", {{.Apikey}});
            });

            var map,
                GoSpatial,
                apikey;

            function initialize(div, apikey) {

                map = L.map(div,{maxZoom: 23});

                GoSpatial = L.gospatial(apikey);
                GoSpatial.addTo(map);

                osm = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png',{ 
                    attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>'
                });
                osm.addTo(map);
                map._baseMaps = {
                    "OSM": osm,
                    "Topographic": L.tileLayer("http://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}.png",{maxNativeZoom:22}),
                    "Streets": L.tileLayer("http://services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}.png",{maxNativeZoom:22}),
                    "Imagery": L.tileLayer("http://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}.png",{maxNativeZoom:22})
                };

                var osmb = new OSMBuildings(map)
                   .date(new Date(2015, 5, 15, 17, 30))
                   .load()
                   .click(function(id) {
                        console.log('feature id clicked:', id);
                   }
                );

                var overlayMaps = { Buildings: osmb };

                L.control.layers(map._baseMaps, overlayMaps, {position: 'topright'}).addTo(map);

            }

        </script>

    </body>
</html>
